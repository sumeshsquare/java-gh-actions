# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: Java CI with Maven

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
        
    - name: Test with Maven
      run: mvn clean test

#     - name: slack-send
#       # You may pin to the exact commit or the version.
#       # uses: slackapi/slack-github-action@34c3fd73326693ef04728f8611669d918a2d781d
#       uses: slackapi/slack-github-action@v1.19.0
#       with:
#         # Slack channel ID where message will be posted. Needed if using bot token
#         channel-id: # optional
#         # Message to post into Slack. Needed if using bot token
#         slack-message: # optional
#         # JSON payload to send to Slack if webhook route. If not supplied, json from GitHub event will be sent instead
#         payload: # optional
#         # path to JSON payload to send to Slack if webhook route. If not supplied, json from GitHub event will be sent instead. If payload is provided, it will take preference over this field
#         payload-file-path: # optional

    - name: Build with Maven
      run: |
            mvn clean package
            mkdir artifacts && cp target/*.jar artifacts
            cd artifacts && ls
            
    - name: Upload Maven build artifact
      uses: actions/upload-artifact@v2
      with:
        name: artifact
        path: artifacts

    - name: "Configure AWS Credentials" Action For GitHub Actions
      # You may pin to the exact commit or the version.
      # uses: aws-actions/configure-aws-credentials@05b148adc31e091bafbaf404f745055d4d3bc9d2
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.ACCESS_KEY }}
        aws-secret-access-key: ${{ secrets.SECRET_KEY }}
        aws-region: us-east-1

    - name: AWS CodeArtifact Auth
      # You may pin to the exact commit or the version.
      # uses: advancedcsg-open/actions-aws-codeartifact-auth@d78a505bfcb44899e2ce7026b6fedc57c94170f2
      uses: advancedcsg-open/actions-aws-codeartifact-auth@v1.0.0
      with:
        # AWS CodeArtifact Region
        region: us-east-1
        # AWS CodeArtifact Domain
        domain: poc
        # AWS CodeArtifact Domain Owner
        domain-owner: 420928831421
        # The time, in seconds, that the generated authorization token is valid
        duration: 900 # optional, default is 0
